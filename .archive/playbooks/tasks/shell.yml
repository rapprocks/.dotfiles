---
- name: Install shell packages
  become: true
  community.general.pacman:
    name: "{{ shell_packages }}"
    state: present
  changed_when: false

- name: Check if oh-my-zsh is already installed
  stat:
    path: $HOME/.oh-my-zsh
  register: folder_check

- name: Install Oh-my-zsh
  ansible.builtin.shell: sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
  when: not folder_check.stat.exists

- name: Check if autogenerated zshrc file exists
  ansible.builtin.stat:
    path: /home/philip/.zshrc
  register: file_status

- debug:
    var: file_status

- name: Remove autogenerated zshrc file if it exists
  ansible.builtin.file:
    path: /home/philip/.zsrhc
    state: absent
  become: yes
  when: file_status.stat.exists

- name: Symlink .zshrc from dotfiles
  ansible.builtin.file:
    src: $HOME/dotfiles/env/.zshrc
    dest: $HOME/.zshrc
    state: link

- name: Ensure the tmux directory exists
  ansible.builtin.file:
    path: $HOME/.config/tmux
    state: directory

- name: Symlink tmux from dotfiles
  ansible.builtin.file:
    src: $HOME/dotfiles/env/.config/tmux/tmux.conf
    dest: $HOME/.config/tmux/tmux.conf
    state: link

- name: Symlink starship
  ansible.builtin.file:
    src: $HOME/dotfiles/env/.config/starship.toml
    dest: $HOME/.config/starship.toml
    state: link

#- name: Set default shell to zsh
#  ansible.builtin.shell: chsh -s /usr/bin/zsh
